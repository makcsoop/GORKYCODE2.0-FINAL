# Gorky Quest System

Система геймификации с квестами и балансом коинов.

## Установка и запуск

1. Активируйте виртуальное окружение:
```bash
source venv/bin/activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Инициализируйте базу данных (создаст пользователя admin/admin):
```bash
python init_db.py
```

4. Запустите приложение:
```bash
python main.py
```

5. Откройте в браузере: `http://127.0.0.1:8002`

## Вход в систему

- **Логин:** admin
- **Пароль:** admin

## Структура базы данных

### User (Пользователь)
- `id` - уникальный идентификатор
- `login` - логин (уникальный)
- `password` - пароль
- `email` - email
- `tg_name` - имя в Telegram
- `balance` - баланс коинов (по умолчанию 0)

### Quest (Квест)
- `id` - уникальный идентификатор
- `title` - название квеста
- `description` - описание
- `latitude` - широта (координата)
- `longitude` - долгота (координата)
- `points` - количество коинов за выполнение
- `status` - статус (не взята, в исполнении, выполнена)
- `image_path` - путь к картинке с картой

### QuestReport (Отчет о квесте)
- `id` - уникальный идентификатор
- `quest_id` - ID квеста
- `user_id` - ID пользователя
- `is_completed` - выполнена ли заявка
- `photo_path` - путь к загруженному фото
- `comment` - комментарий
- `created_date` - дата создания отчета

## Функциональность

1. **Регистрация и авторизация** - пользователи могут регистрироваться и входить в систему
2. **Баланс коинов** - у каждого пользователя есть баланс, который отображается в профиле
3. **Список квестов** - просмотр всех доступных квестов
4. **Принятие квеста** - пользователь может принять квест
5. **Отчет о выполнении** - после принятия квеста можно отправить отчет с фото и комментарием
6. **Начисление коинов** - при выполнении квеста начисляются коины на баланс пользователя

## Маршруты

- `/` - главная страница
- `/authorization` - страница входа
- `/registration` - страница регистрации
- `/dashboard` - профиль пользователя
- `/quests` - список всех квестов
- `/quest/<id>` - детальная страница квеста
- `/quest/<id>/take` - принять квест (POST)
- `/quest/<id>/report` - отправить отчет (POST)
- `/logout` - выход из системы

## Добавление квестов

Квесты можно добавить через скрипт `init_db.py` или напрямую в базу данных.

Для добавления квеста через Python:
```python
from data import db_session
from data.quests import Quest

db_session.global_init('db/base.db')
db_sess = db_session.create_session()

quest = Quest(
    title="Название квеста",
    description="Описание квеста",
    latitude=56.3269,
    longitude=44.0075,
    points=100,
    status="не взята",
    image_path="static/img/quest_map_1.png"
)

db_sess.add(quest)
db_sess.commit()
db_sess.close()
```

## Примечания

- Картинки квестов должны быть размещены в `static/img/`
- Загруженные фото отчетов сохраняются в `static/uploads/`
- База данных находится в `db/base.db`


